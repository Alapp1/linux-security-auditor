<!doctype html>
<html>
  <head>
    <title>Linux Security Auditor</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #f5f5f5;
        display: flex;
      }
      .sidebar {
        width: 300px;
        background: white;
        padding: 20px;
        height: 100vh;
        overflow-y: auto;
        border-right: 1px solid #ddd;
      }
      .main-content {
        flex: 1;
        padding: 20px;
      }
      .header {
        background: #2c3e50;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .scan-form {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        align-items: end;
      }
      .form-group {
        flex: 1;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }
      .form-group input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      .stats {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        flex: 1;
        text-align: center;
      }
      .critical {
        border-left: 5px solid #e74c3c;
      }
      .high {
        border-left: 5px solid #f39c12;
      }
      .medium {
        border-left: 5px solid #f1c40f;
      }
      .findings {
        background: white;
        padding: 20px;
        border-radius: 8px;
      }
      .finding {
        padding: 15px;
        border-bottom: 1px solid #eee;
      }
      .finding:last-child {
        border-bottom: none;
      }
      .level {
        padding: 4px 8px;
        border-radius: 4px;
        color: white;
        font-size: 12px;
      }
      .level.CRITICAL {
        background: #e74c3c;
      }
      .level.HIGH {
        background: #f39c12;
      }
      .level.MEDIUM {
        background: #f1c40f;
      }
      .level.ERROR {
        background: #8e44ad;
      }
      .scan-button {
        padding: 10px 20px;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .scan-button.active {
        background: #27ae60;
      }
      .scan-button.disabled {
        background: #95a5a6;
        cursor: not-allowed;
      }
      .preset-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }
      .preset-btn {
        padding: 5px 10px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .preset-btn:hover {
        background: #2980b9;
      }
      .history-item {
        padding: 10px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
      }
      .history-item:hover {
        background: #f8f9fa;
      }
      .history-item.active {
        background: #e3f2fd;
        border-left: 3px solid #2196f3;
      }
      .history-item h4 {
        margin: 0 0 5px 0;
        font-size: 14px;
      }
      .history-item p {
        margin: 0;
        font-size: 12px;
        color: #666;
      }
      .historical-banner {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
      }
    </style>
    <script>
      function loadPreset(host, port, username, password, name) {
        document.getElementById("host").value = host;
        document.getElementById("port").value = port;
        document.getElementById("username").value = username;
        document.getElementById("password").value = password;
        document.getElementById("target_name").value = name;
      }

      function checkStatus() {
        fetch("/status")
          .then((response) => response.json())
          .then((data) => {
            if (data.running) {
              setTimeout(() => {
                location.reload();
              }, 3000);
            }
          });
      }

      window.onload = checkStatus;
    </script>
  </head>
  <body>
    <div class="sidebar">
      <h3>Scan History</h3>
      {% if scan_history %} {% for scan in scan_history %}
      <div
        class="history-item {% if scan.scan_id == report.scan_id %}active{% endif %}"
        onclick="window.location.href='/scan/{{ scan.scan_id }}'"
      >
        <h4>{{ scan.target_name }}</h4>
        <p>{{ scan.scan_date }}</p>
        <p>{{ scan.total_findings }} findings</p>
      </div>
      {% endfor %} {% else %}
      <p style="color: #666; font-style: italic">No scans yet</p>
      {% endif %}
    </div>

    <div class="main-content">
      {% if viewing_historical %}
      <div class="historical-banner">
        <strong>Historical Scan:</strong> You're viewing a previous scan.
        <a href="/">Return to latest</a>
      </div>
      {% endif %}

      <div class="header">
        <h1>Linux Security Auditor</h1>
        <p>Interactive Security Scanner for Linux Systems</p>
        {% if scan_status.last_scan %}
        <p><small>Last scan: {{ scan_status.last_scan }}</small></p>
        {% endif %}
      </div>

      <div class="scan-form">
        <h2>Target Configuration</h2>

        <div class="preset-buttons">
          <button
            class="preset-btn"
            onclick="loadPreset('localhost', '2222', 'root', 'password', 'Test Container 1')"
          >
            Test Container 1
          </button>
          <button
            class="preset-btn"
            onclick="loadPreset('localhost', '2223', 'root', 'password', 'Test Container 2')"
          >
            Test Container 2
          </button>
          <button
            class="preset-btn"
            onclick="loadPreset('192.168.1.100', '22', 'admin', '', 'Custom Server')"
          >
            Custom Server
          </button>
        </div>

        <form method="POST" action="/scan">
          <div class="form-row">
            <div class="form-group">
              <label for="target_name">Target Name:</label>
              <input
                type="text"
                id="target_name"
                name="target_name"
                value="My Linux Server"
                placeholder="e.g., Production Web Server"
              />
            </div>
            <div class="form-group">
              <label for="host">Host/IP:</label>
              <input
                type="text"
                id="host"
                name="host"
                value="localhost"
                placeholder="e.g., 192.168.1.100"
                required
              />
            </div>
            <div class="form-group">
              <label for="port">SSH Port:</label>
              <input
                type="number"
                id="port"
                name="port"
                value="2222"
                placeholder="22"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="username">Username:</label>
              <input
                type="text"
                id="username"
                name="username"
                value="root"
                placeholder="root"
                required
              />
            </div>
            <div class="form-group">
              <label for="password">Password:</label>
              <input
                type="password"
                id="password"
                name="password"
                value="password"
                placeholder="Enter password"
              />
            </div>
            <div class="form-group">
              {% if scan_status.running %}
              <button type="button" class="scan-button disabled" disabled>
                Scanning...
              </button>
              {% else %}
              <button type="submit" class="scan-button active">
                Start Security Scan
              </button>
              {% endif %}
            </div>
          </div>
        </form>
      </div>

      <div class="stats">
        <div class="stat-card critical">
          <h3>
            {{ report.findings | selectattr('level', 'equalto', 'CRITICAL') |
            list | length }}
          </h3>
          <p>Critical Issues</p>
        </div>
        <div class="stat-card high">
          <h3>
            {{ report.findings | selectattr('level', 'equalto', 'HIGH') | list |
            length }}
          </h3>
          <p>High Priority</p>
        </div>
        <div class="stat-card medium">
          <h3>
            {{ report.findings | selectattr('level', 'equalto', 'MEDIUM') | list
            | length }}
          </h3>
          <p>Medium Priority</p>
        </div>
        <div class="stat-card">
          <h3>{{ report.total_findings or 0 }}</h3>
          <p>Total Findings</p>
        </div>
      </div>

      <div class="findings">
        <h2>Security Findings</h2>
        {% if report.scan_target %}
        <p><strong>Target:</strong> {{ report.scan_target }}</p>
        {% endif %} {% if scan_status.running %}
        <div style="text-align: center; padding: 40px; color: #7f8c8d">
          <h3>Scan in Progress...</h3>
          <p>Analyzing system security configuration...</p>
        </div>
        {% elif report.findings %} {% for finding in report.findings %}
        <div class="finding">
          <span class="level {{ finding.level }}">{{ finding.level }}</span>
          <strong>{{ finding.category }}</strong>: {{ finding.issue }} {% if
          finding.recommendation %}
          <p style="margin: 8px 0 0 0; color: #666">
            <em>Recommendation: {{ finding.recommendation }}</em>
          </p>
          {% endif %}
          <p style="margin: 4px 0 0 0; font-size: 12px; color: #999">
            {{ finding.timestamp }}
          </p>
        </div>
        {% endfor %} {% else %}
        <div style="text-align: center; padding: 40px; color: #7f8c8d">
          <h3>Ready to Scan</h3>
          <p>
            Configure your target above and click "Start Security Scan" to
            begin.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </body>
</html>
